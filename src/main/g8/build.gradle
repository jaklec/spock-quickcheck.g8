apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'application'

mainClassName = 'org.example.HelloWorld'

version = "$project_version$"

sourceCompatibility = 1.8  
targetCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.3.7'
    testCompile 'org.spockframework:spock-core:0.7-groovy-2.0'
    testCompile 'net.java:quickcheck:0.6'
}

//test.outputs.upToDateWhen { false }

jar {
    manifest {
        attributes 'Built-Date': new Date(), 'Main-Class': mainClassName
    }
}

task fatjar(type: Jar) {
    baseName = project.name + '-all'
    archiveName = baseName + '.jar'
    from (configurations.compile.collect { it.isDirectory() ? it : zipTree(it) })

    manifest {
        attributes 'Built-Date': new Date(), 'Main-Class': mainClassName
    }

    with jar
}

task docker(type: Exec, dependsOn: fatjar) {
    executable 'docker'
    args 'build', '--tag="' + project.name + '"', '.'
}

task rundocker(type: Exec) {
    executable 'docker'
    args 'run', '--rm', project.name
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.0'
}
